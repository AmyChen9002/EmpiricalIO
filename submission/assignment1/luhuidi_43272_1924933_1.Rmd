---
title: 'Assignment 1: Report'
author: "Huidi LU, 20376663"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::read_chunk('../R/loglikelihood_A1.R')
library(tidyverse)
library(evd)
library(ECON6120I)
```

## Simulate Data

Consider to simulate data from the following model and estimate the parameters from the simulated data $$y_{ij}=1\{j=\arg\max_{k=1,2} \beta x_k + \varepsilon_{ik}\}$$ where $\varepsilon_{ik}$ follows i.i.d. type-I extreme value distribution, $\beta=0.2$, $x_1=0$ and $x_2=1$.

1. To simulate data, first make a data frame as follows:

```{r}
tbl = tibble(i=rep(1:1000, each=2), k=rep(1:2,1000), x=rep(0:1, 1000)); tbl
```

2. Second, draw type-I extreme value random variables. Set the seed at 1. You can use `evd` package to draw the variables. You should get exactly the same realization if the seed is correctly set.

```{r}
set.seed(1); tbl$e = rgumbel(2000); tbl
```

3. Third, compute the latent value of each option to obtain the following data frame:

```{r}
tbl$latent = 0.2*tbl$x+tbl$e; tbl
```

4. Finally, compute $y$ by comparing the latent values of $k=1,2$ for each $i$ to obtain the following result:

```{r}
choice = tapply(tbl$latent, tbl$i, which.max); # for each individual, I find the index of choice (1 or 2) that maximizes utility. This is done by applying the `which.max` function for each individual's latent utilities.

tbl$y = as.integer(rep(choice,each=2)==tbl$k); # y=1 if the choice index euqals k

tbl
```

## Estimate the parameter

The loglikelihood is $$l(\beta)=\sum_{i=1}^{1000} \{y_{i1}\log p_{i1}(\beta) + (1-y_{i1})\log [1-p_{i1}(\beta)] \},$$ where $$p_{ik}(\beta)=\dfrac{exp(\beta x_k)}{exp(\beta x_1)+exp(\beta x_2)}$$.

1. Write a function to compute the likelihood for a given $\beta$ and data and name the function `loglikelihood_A1`.

```{r llk-a1, eval=FALSE} 
# This displays the content in file `loglikelihood_A1.R`. `llk-a1` is the alias I set.
```


2. Compute the value of log likelihood for $\beta=0,0.1,\cdots,1$ and plot the result using `ggplot2` packages.

```{r}
l=apply(as.array(0:10/10),1,function(x){loglikelihood_A1(tbl, x)})
qplot(0:10/10, l ,xlab=expression(beta), ylab='Log Likelihood')
```

3. Find and report $\beta$ that maximizes the log likelihood for the simulated data. You can use `optim` function to achieve this. You will use `Brent` method and set the lower bound at -1 and upper bound at 1 for the parameter search.
  
```{r}
optim(0,function(x){-loglikelihood_A1(tbl, x)},method='Brent',lower=-1,upper=1)
```




