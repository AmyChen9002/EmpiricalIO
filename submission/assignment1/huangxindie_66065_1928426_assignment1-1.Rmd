---
title: "Assignment 1: Basic Programming in R"
author: "Xindie Huang (20561232)"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## I. Simulate Data

1. To simulate data, first make a data frame as follows.
```{r}
# clear the working environment
rm(list = ls())
library(tibble)
df <- tibble(i = rep(1:1000, each = 2), k = rep(1:2, times = 1000), x = rep(0:1, times = 1000))
df
```

2. Second, draw type-I extreme value random variables. Set the seed at 1. You can use `evd` package to draw the variables. You should get exactly the same realization if the seed is correctly set.
```{r}
library(evd)
set.seed(1)
df <- add_column(df, e = rgumbel(n = 2000, loc = 0, scale = 1))
df
```

3. Third, compute the latent value of each option to obtain the following data frame:
```{r}
beta <- 0.2
df <- add_column(df, latent = beta * df$x + df$e)
df
```

4. Finally, compute $y$ by comparing the latent values of $k=1,2$ for each $i$ to obtain the following result:
```{r}
df <- add_column(df, y = rep(0, times = 2000))
for (t in 1:1000) {
  ifelse(df$i[2 * t] == df$i[2 * t - 1] && df$latent[2 * t] >= df$latent[2 * t - 1], df$y[2 * t] <- 1, df$y[2 * t - 1] <- 1)
}
rm(t)
df
```


## II. Estimate the Parameters

1. Write a function to compute the likelihood for a given $\beta$ and data and name the function `loglikelihood_A1`.
```{r}
source("../R/functions.R") # see details in "R/functions.R"
```

2. Compute the value of log likelihood for $\beta = 0,0.1,...,1$ and plot the result using `ggplot2` packages. You can use `latex2exp` package to use $\LaTeX$ math symbol in the label:
```{r}
library(ggplot2)
library(latex2exp)
beta <- seq(from = 0, to = 1, by = 0.1)
Loglikelihood <- c()
for (i in 1:length(beta)) {
  Loglikelihood <- c(Loglikelihood, loglikelihood_A1(beta[i], df))
}
qplot(x = beta, y = Loglikelihood, xlab = TeX('$\\beta$'), ylab = "Loglikelihood")
```

3. Find and report $\beta$ that maximizes the log likelihood for the simulated data. You can use `optim` function to achieve this. You will use `Brent` method and set the lower bound at -1 and upper bound at 1 for the parameter search.

```{r}
optim(par = -1, fn = loglikelihood_A1, data = df, method = "Brent", control = list(fnscale = -1), lower = -1, upper = 1, hessian = FALSE)
```