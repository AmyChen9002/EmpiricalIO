---
title: "Assignment 1: Basic Programming in R"
author: "Paul Wang"
date: "February 18, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

## Simulate data
Consider to simulate data from the following model and estimate the parameters from the simulated data.

$$
y_{ij} = 1 \{ j = \text{argmax}_{k = 1,2} \beta x_k + \epsilon_{ik} \}
$$
where $\epsilon_{ik}$ follows i.i.d type-I extreme value distribution, $\beta = 0.2, x_1 = 0$ and $x_2 = 1$.

1. To simulate data, first make a data frame as follows:

```{r}
n <- 2000

df <- tibble::tibble(
    i = rep(1:(n/2),each=2),
    k = rep(1:2,times=n/2),
    x = rep(0:1,times=n/2)
)
df
```

2. draw type-I extreme value random variables. Set the seed at 1. You can use evd package to draw the variables. You should get exactly the same realization if the seed is correctly set.

```{r}
set.seed(1)
df <- tibble::add_column(df, e = evd::rgev(n,loc=0,scale=1,shape=0))

df
```

3. Third, compute the latent value of each option to obtain the following data frame:
```{r}
beta <- 0.2
df <- dplyr::mutate(df,
  latent = beta * x + e
)

df
```

4. Finally, compute $y$ by comparing the latent values of $k=1,2$ for each $i$ to obtain the following result:
```{r}
df <- tibble::add_column(df, y = 0)

t <- 1
for (j in 1:n) {
  df$y[j] = dplyr::if_else(max(dplyr::filter(df, i == t)$latent) == df$latent[j],1,0)
  if (j %% 2 == 0) {t = t + 1}
}

df
```



## Estimate the parameter

Now you generated simulated data. Suppose you observe $x_k$ and $y_{ik}$ for each $i$ and $k$ and estimate $\beta$ by a maximum likelihood estimator. The likelihood for $i$ to choose $k (y_{ik} = 1)$ can be shown to be: 
$$
p_{ik}(\beta) = \frac{\exp(\beta x_k)}{\exp(\beta x_1) + \exp(\beta x_2)}.
$$

Then, the likelihood of observing $\{ y_{ik} \}_{i,k}$ is:
$$
L(\beta) = \prod_{i=1}^{1000} p_{i1}(\beta)^{y_{i1}} [1 - p_{i1} (\beta)]^{1 - y_{i1}},
$$
and the log likelihood is:
$$
l(\beta) = \sum_{i=1}^{1000} \{y_{i1} \log p_{i1}(\beta) + (1 - y_{i1}) \log [1 - p_{i1} (\beta)] \}.
$$


1. Write a function to compute the livelihood for a given $\beta$ and data and name the function loglikelihood.

2. Compute the value of log likelihood for $\beta=0,0.1,...,1$ and plot the result using ggplot2 packages. You can use latex2exp package to use LaTeX math symbol in the label: 

```{r}
betas <- seq(from = 0, to = 1, by = 0.1)
loglikedf <- tibble::tibble(
  b = seq(from = 0, to = 1, by = 0.1),
  l = ECON6120I::loglikelihood(b,df)
)

ggplot2::qplot(loglikedf$b, loglikedf$l, xlab = latex2exp::TeX('$\\beta$'), ylab = 'Loglikelihood')
```

3. Find and report $\beta$ that maximizes the log likelihood for the simulated data. You can use optim function to achieve this. You will use Brent method and set the lower bound at -1 and upper bound at 1 for the parameter search.

```{r}
stats::optim(par = 0.2, fn = ECON6120I::loglikelihood, df = df, method = "Brent", lower = -1, upper = 1, control=list(fnscale=-1))
```
