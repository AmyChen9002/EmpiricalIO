---
title: "assignment2"
author: "Si_ZUO"
date: "2019/02/25"
output:
  html_document:
    df_print: paged
  pdf_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T)
knitr::opts_chunk$set(error = TRUE)
```

# simulate data
#1
```{r 1_1}
beta_0<-1
beta_l<-0.2
beta_k<-0.7
alpha<-0.7
sigma_eta<-0.2
sigma_nu<-0.5
sigma_w<-0.1
delta<-0.05
beta_0
beta_l
beta_k
alpha
sigma_eta
sigma_nu
sigma_w
delta
```

#2
```{r 1_2}
log_production<-
  function(l,k,omega,eta,beta_0,beta_l,beta_k){
    y_1_2<-beta_0+beta_l*l+beta_k*k+omega+eta
return(y_1_2)
  }
log_production(1,1,1,1,1,0.2,0.7)
```
#3
```{r 1_3}
log_labor_choice<-
  function(k, wage, omega, beta_0, beta_l, beta_k, sigma_eta){
l_1_3<-(log(wage)-log(beta_l)-beta_0-beta_k*k-omega-1/2*sigma_eta^2)/(beta_l-1)
return(l_1_3)
  }

log_labor_choice(1,0.5,1,1,0.2,0.7,0.2)
```
#4
```{r 1_4}
log_labor_choice_error<-
  function(k, wage, omega, beta_0, beta_l, beta_k, iota, sigma_eta){
l_1_4<-(log(wage)-log(beta_l)-beta_0-beta_k*k-omega-iota-1/2*sigma_eta^2)/(beta_l-1)
return(l_1_4)
  }

log_labor_choice_error(1,0.5,1,1,0.2,0.7,0.5,0.2)
```
#5
```{r 1_5}
gamma<-0.1
investment_choice<-
  function(k, omega,gamma,delta){
i_1_5<-(delta+gamma*omega)*exp(k)
return(i_1_5)
  }

investment_choice(1,1,0.1,1)
```
#6
```{r 1_6}
j<-c(1:1000)
t<-c(rep(1,1000))
wage<-c(rep(0.5,1000))
set.seed(1)
k<-rnorm(1000,1,0.5)
omega<-rnorm(1000,0,0.5)
omega<-1.4*omega
iota<-rnorm(1000,0,0.025)
iota<-2*iota
eta<-rnorm(1000,0,0.02)
A_1_6<-data.frame(j,t,k,omega,wage)
str(A_1_6)
```
#7
```{r 1_7}
l<-log_labor_choice(k, wage, omega, beta_0, beta_l, beta_k, sigma_eta)
l_error<-log_labor_choice_error(k, wage, omega, beta_0, beta_l, beta_k, iota, sigma_eta)
I<-investment_choice(k, omega,gamma,delta)
A_1_7<-data.frame(j,t,k,omega,wage,iota,l,l_error,I)
str(A_1_7)
```
#8
```{r 1_8}
y<-log_production(l,k,omega,eta,beta_0,beta_l,beta_k)
y_error<-log_production(l_error,k,omega,eta,beta_0,beta_l,beta_k)
A_1_8<-data.frame(j,t,k,omega,wage,iota,l,l_error,I,eta,y,y_error)
str(A_1_8)
```
#9
```{r 1_9}
j_10<-rep(j, times = 10)
t_10<-rep(1:10,each=1000)
wage_10<-c(rep(0.5,10000))
k_10<-0.95^(t_10-1)*k
str(k_10)
omega_10<-0.7^(t_10-1)*omega
iota_10<-0.7^(t_10-1)*iota
eta_10<-rep(eta,times=10)
l_10<-log_labor_choice(k_10, wage_10, omega_10, beta_0, beta_l, beta_k, sigma_eta)
l_error_10<-log_labor_choice_error(k_10, wage_10, omega_10, beta_0, beta_l, beta_k, iota_10, sigma_eta)
I_10<-investment_choice(k_10, omega_10,gamma,delta)
y_10<-log_production(l_10,k_10,omega_10,eta_10,beta_0,beta_l,beta_k)
y_error_10<-log_production(l_error_10,k_10,omega_10,eta_10,beta_0,beta_l,beta_k)
df_T<-data.frame(j_10,t_10,k_10,omega_10,wage_10,iota_10,l_10,l_error_10,I_10,eta_10,y_10,y_error_10)
str(df_T)
```
#10
```{r 1_10}
summary(df_T)
``` 
#2
#1
```{r 2_1}
out <- lm(formula = y_error_10 ~ l_error_10 + k_10, data = df_T)
summary(out)
```
#2
```{r 2_2}
df_T_within<-within(df_T,{
  dy_error<-y_error_10-mean(y_error_10)
   dl_error<-l_error_10-mean(l_error_10)
    dk<-k_10-mean(k_10)
})
out_2 <-lm(dy_error ~ -1 + dl_error + dk,data = df_T_within)
summary(out_2)
```
#3_1
```{r 2_3_1}
X <- data.frame(l_error_10)
Z <- data.frame(k_10,I_10)
bw <- npplregbw(xdat=X, zdat=Z, ydat=y_error_10)
pl <- npplreg(bws=bw)
summary(pl)
```
#3_2
```{r 2_3_2}
#plotting fitted and original values
library(ggplot2)
ggplot(df_T, aes(x=predict(pl), y=y_error_10))+
  geom_point()+labs(x ="fitted", y = "actual")
```
#4
```{r 2_4}
X <- data.frame(l_10)
Z <- data.frame(k_10,I_10)
bw_1 <- npplregbw(xdat=X, zdat=Z, ydat=y_10)
pl_1 <- npplreg(bws=bw)
summary(pl_1)
```
#5
```{r 2_5}
y_error_tilde<-y_error_10-1.180628*l_error_10
phi_t_1<-y_error_tilde-eta_10
df_T_1st<-data.frame(j_10,t_10,y_error_tilde,phi_t_1)
str(df_T_1st)
```
#6
```{r 2_6}
y_error_tilde<-y_error_10-1.180628*l_error_10
phi_t_1<-y_error_tilde-eta_10
df_T_1st<-data.frame(j_10,t_10,y_error_tilde,phi_t_1)
str(df_T_1st)
```

# 2_3-2_4
```{r pressure, echo=FALSE, fig.cap="A caption", out.width = '100%'}
knitr::include_graphics("2_3_1.PNG")
knitr::include_graphics("2_3_2.PNG")
knitr::include_graphics("2_4.PNG")
```